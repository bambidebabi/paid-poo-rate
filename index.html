<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¸¦è–ªæ‹‰å±è®¡ç®—å™¨</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
</head>

<body>
    <div class="calculator-container">
        <h1 class="title">å¸¦è–ªæ‹‰å±è®¡ç®—å™¨ ğŸ’©</h1>

        <div class="result-card">
            <p class="result-label">æ‚¨çš„æ—¶è–ª (Hourly Rate)</p>
            <div class="hourly-rate-display">
                <span class="currency-symbol">Â¥</span>
                <span id="hourlyRate" class="rate-value">0.00</span>
                <span class="unit">/ å°æ—¶</span>
            </div>
        </div>

        <div class="realtime-card">
            <p class="realtime-label">å®æ—¶æ”¶å…¥ (Real-Time Earning)</p>
            <div class="realtime-display">
                <span class="currency-symbol">Â¥</span>
                <span id="realtimeEarning" class="rate-value">0.00</span>
            </div>
            <p class="timer-display">
                å·²è®¡æ—¶: <span id="elapsedTime">00:00:00</span>
            </p>
        </div>

        <div class="input-section">
            <div class="input-group">
                <label for="totalIncome">æ€»æ”¶å…¥ (Total Income)</label>
                <input type="number" id="totalIncome" placeholder="è¾“å…¥ç¨å‰æ€»æ”¶å…¥" value="0">
            </div>

            <div class="input-group">
                <label>æ€»å·¥æ—¶è®¡ç®—æ–¹å¼</label>
                <div class="toggle-switch">
                    <button id="modeTotalHours" class="toggle-button active">è¾“å…¥æ€»å°æ—¶</button>
                    <button id="modeByDay" class="toggle-button">æŒ‰å¤©è®¡ç®—</button>
                </div>
            </div>

            <div id="hoursMode" class="input-mode active-mode">
                <div class="input-group">
                    <label for="totalHours">æ€»å·¥æ—¶ (Total Hours)</label>
                    <input type="number" id="totalHours" placeholder="è¾“å…¥å®é™…å·¥ä½œå°æ—¶æ•° (å°æ—¶)" value="0">
                </div>
            </div>

            <div id="dayMode" class="input-mode hidden-mode">
                <div class="input-group">
                    <label for="workDays">å·¥ä½œå¤©æ•°</label>
                    <input type="number" id="workDays" placeholder="è¾“å…¥æ€»å…±å·¥ä½œçš„å¤©æ•° (å¤©)" value="1" min="1">
                </div>
                <div class="input-group time-group">
                    <label for="startTime">æ¯æ—¥ä¸Šç­æ—¶é—´</label>
                    <input type="time" id="startTime" value="09:00">
                </div>
                <div class="input-group time-group">
                    <label for="endTime">æ¯æ—¥ä¸‹ç­æ—¶é—´</label>
                    <input type="time" id="endTime" value="18:00">
                </div>
                <div class="input-group">
                    <label for="overtime">æ¯æ—¥åŠ ç­æ—¶é•¿</label>
                    <input type="number" id="overtime" placeholder="è¾“å…¥æ¯æ—¥åŠ ç­å°æ—¶æ•° (å°æ—¶)" value="0">
                </div>
                <p class="summary-text">æ€»å·¥æ—¶é¢„ä¼°: <span id="estimatedHours">0</span> å°æ—¶</p>
            </div>
        </div>

        <div class="action-section main-actions">
            <button id="calculateButton" class="button primary">è®¡ç®—æ—¶è–ª</button>
            <button id="timerToggleButton" class="button secondary" disabled>å¼€å§‹è®¡æ—¶</button>
        </div>

        <div class="action-section reset-action">
            <button id="resetButton" class="button secondary">é‡ç½®</button>
        </div>
    </div>

    <script>
        let hourlyRate = 0;
        let timerInterval = null;
        let isTimerRunning = false;
        let startTime = 0;
        let elapsedTime = 0;
        let currentMode = 'totalHours'; // è®°å½•å½“å‰æ¨¡å¼

        // --- æ ¸å¿ƒè®¡æ—¶åŠŸèƒ½ï¼ˆä¿æŒä¸å˜ï¼‰ ---

        function formatTime(totalSeconds) {
            const hours = Math.floor(totalSeconds / 3600);
            const minutes = Math.floor((totalSeconds % 3600) / 60);
            const seconds = Math.floor(totalSeconds % 60);

            const pad = (num) => String(num).padStart(2, '0');
            return `${pad(hours)}:${pad(minutes)}:${pad(seconds)}`;
        }

        function updateTimerAndEarning() {
            elapsedTime = Math.floor((Date.now() - startTime) / 1000);
            const earning = (hourlyRate / 3600) * elapsedTime;

            document.getElementById('elapsedTime').textContent = formatTime(elapsedTime);
            document.getElementById('realtimeEarning').textContent = earning.toFixed(2);
        }

        function startTimer() {
            if (hourlyRate <= 0) {
                alert('è¯·å…ˆè®¡ç®—ä¸€ä¸ªæœ‰æ•ˆçš„æ—¶è–ªï¼');
                return;
            }
            if (isTimerRunning) return;

            isTimerRunning = true;
            startTime = Date.now() - (elapsedTime * 1000);

            document.getElementById('timerToggleButton').textContent = 'åœæ­¢è®¡æ—¶';
            document.getElementById('timerToggleButton').classList.remove('secondary');
            document.getElementById('timerToggleButton').classList.add('primary');

            updateTimerAndEarning();
            timerInterval = setInterval(updateTimerAndEarning, 1000);
        }

        function stopTimer() {
            clearInterval(timerInterval);
            isTimerRunning = false;

            document.getElementById('timerToggleButton').textContent = 'ç»§ç»­è®¡æ—¶';
            document.getElementById('timerToggleButton').classList.remove('primary');
            document.getElementById('timerToggleButton').classList.add('secondary');
        }

        // --- æ–°å¢ï¼šæŒ‰å¤©è®¡ç®—æ€»å·¥æ—¶å‡½æ•° ---
        function calculateTotalHoursByDay() {
            const workDays = parseFloat(document.getElementById('workDays').value) || 0;
            const startTimeStr = document.getElementById('startTime').value; // e.g., "09:00"
            const endTimeStr = document.getElementById('endTime').value;   // e.g., "18:00"
            const overtime = parseFloat(document.getElementById('overtime').value) || 0;

            if (workDays <= 0) {
                document.getElementById('estimatedHours').textContent = '0';
                return 0;
            }

            // è§£ææ—¶é—´å­—ç¬¦ä¸²ä¸ºå°æ—¶
            const [startHour, startMinute] = startTimeStr.split(':').map(Number);
            const [endHour, endMinute] = endTimeStr.split(':').map(Number);

            // å°†æ—¶é—´è½¬æ¢ä¸ºåˆ†é’Ÿæ•°
            const startMinutes = startHour * 60 + startMinute;
            let endMinutes = endHour * 60 + endMinute;

            // å¤„ç†è·¨å¤œæƒ…å†µ (å¦‚æœç»“æŸæ—¶é—´å°äºå¼€å§‹æ—¶é—´ï¼Œåˆ™åŠ ä¸Š 24 å°æ—¶)
            if (endMinutes < startMinutes) {
                endMinutes += 24 * 60;
            }

            // è®¡ç®—æ¯æ—¥å·¥ä½œå‡€åˆ†é’Ÿæ•°
            const dailyNetMinutes = endMinutes - startMinutes;
            const dailyNetHours = dailyNetMinutes / 60;

            // æ€»å·¥æ—¶ = (æ¯æ—¥å‡€å°æ—¶ + æ¯æ—¥åŠ ç­å°æ—¶) * å·¥ä½œå¤©æ•°
            const totalHours = (dailyNetHours + overtime) * workDays;

            // æ›´æ–°é¢„ä¼°æ˜¾ç¤º
            document.getElementById('estimatedHours').textContent = totalHours.toFixed(2);

            return totalHours;
        }

        // --- æ–°å¢ï¼šæ¨¡å¼åˆ‡æ¢å‡½æ•° ---
        function switchMode(newMode) {
            currentMode = newMode;

            // åˆ‡æ¢æŒ‰é’®æ¿€æ´»çŠ¶æ€
            document.getElementById('modeTotalHours').classList.remove('active');
            document.getElementById('modeByDay').classList.remove('active');
            document.getElementById('hoursMode').classList.remove('active-mode', 'hidden-mode');
            document.getElementById('dayMode').classList.remove('active-mode', 'hidden-mode');

            if (newMode === 'totalHours') {
                document.getElementById('modeTotalHours').classList.add('active');
                document.getElementById('hoursMode').classList.add('active-mode');
                document.getElementById('dayMode').classList.add('hidden-mode');
            } else {
                document.getElementById('modeByDay').classList.add('active');
                document.getElementById('dayMode').classList.add('active-mode');
                document.getElementById('hoursMode').classList.add('hidden-mode');
                // åˆ‡æ¢åˆ°æŒ‰å¤©æ¨¡å¼æ—¶ï¼Œç«‹å³è®¡ç®—ä¸€æ¬¡é¢„ä¼°å·¥æ—¶
                calculateTotalHoursByDay();
            }
        }

        // --- äº‹ä»¶ç›‘å¬å™¨æ›´æ–° ---

        // æ¨¡å¼åˆ‡æ¢æŒ‰é’®ç›‘å¬å™¨
        document.getElementById('modeTotalHours').addEventListener('click', () => switchMode('totalHours'));
        document.getElementById('modeByDay').addEventListener('click', () => switchMode('byDay'));

        // æŒ‰å¤©æ¨¡å¼ä¸‹è¾“å…¥æ¡†å˜åŒ–æ—¶ï¼Œå®æ—¶æ›´æ–°é¢„ä¼°å·¥æ—¶
        document.querySelectorAll('#dayMode input').forEach(input => {
            input.addEventListener('input', calculateTotalHoursByDay);
        });

        // è®¡æ—¶æŒ‰é’®ç›‘å¬å™¨ï¼ˆä¿æŒä¸å˜ï¼‰
        document.getElementById('timerToggleButton').addEventListener('click', function () {
            if (isTimerRunning) {
                stopTimer();
            } else {
                startTimer();
            }
        });

        // è®¡ç®—æŒ‰é’®ç›‘å¬å™¨ï¼ˆæ›´æ–°ä»¥é€‚åº”æ¨¡å¼åˆ‡æ¢ï¼‰
        document.getElementById('calculateButton').addEventListener('click', function () {
            const income = parseFloat(document.getElementById('totalIncome').value) || 0;
            const rateDisplay = document.getElementById('hourlyRate');
            const timerButton = document.getElementById('timerToggleButton');
            let hours = 0;

            // æ ¹æ®å½“å‰æ¨¡å¼è·å–æ€»å·¥æ—¶
            if (currentMode === 'totalHours') {
                hours = parseFloat(document.getElementById('totalHours').value) || 0;
            } else {
                hours = calculateTotalHoursByDay(); // è°ƒç”¨æŒ‰å¤©è®¡ç®—å‡½æ•°
            }

            if (hours > 0) {
                hourlyRate = income / hours;
                rateDisplay.textContent = hourlyRate.toFixed(2);
                timerButton.disabled = false;

                if (isTimerRunning) stopTimer();
                elapsedTime = 0;
                document.getElementById('elapsedTime').textContent = '00:00:00';
                document.getElementById('realtimeEarning').textContent = '0.00';
                document.getElementById('timerToggleButton').textContent = 'å¼€å§‹è®¡æ—¶';
            } else {
                rateDisplay.textContent = '0.00';
                hourlyRate = 0;
                timerButton.disabled = true;
                if (isTimerRunning) stopTimer();
                alert('æ€»å·¥æ—¶å¿…é¡»å¤§äº 0ï¼');
            }
        });

        // é‡ç½®æŒ‰é’®ç›‘å¬å™¨ï¼ˆæ›´æ–°ï¼‰
        document.getElementById('resetButton').addEventListener('click', function () {
            document.getElementById('totalIncome').value = '0';
            document.getElementById('totalHours').value = '0';
            document.getElementById('hourlyRate').textContent = '0.00';
            document.getElementById('timerToggleButton').disabled = true;

            if (isTimerRunning) stopTimer();
            hourlyRate = 0;
            elapsedTime = 0;
            document.getElementById('elapsedTime').textContent = '00:00:00';
            document.getElementById('realtimeEarning').textContent = '0.00';

            document.getElementById('timerToggleButton').textContent = 'å¼€å§‹è®¡æ—¶';
            document.getElementById('timerToggleButton').classList.remove('primary');
            document.getElementById('timerToggleButton').classList.add('secondary');

            // ç¡®ä¿æŒ‰å¤©è®¡ç®—çš„é¢„ä¼°å°æ—¶æ•°ä¹Ÿè¢«é‡ç½®ï¼ˆè™½ç„¶è®¡ç®—å‡½æ•°ä¼šå¤„ç†ï¼‰
            document.getElementById('estimatedHours').textContent = '0';
        });

        // åˆå§‹åŒ–æ—¶è®¾ç½®é»˜è®¤æ¨¡å¼
        document.addEventListener('DOMContentLoaded', () => {
            switchMode('totalHours');
        });
    </script>
</body>

</html>